# Ch01操作系统概述

## 计算机系统是人工自然系统的集大成者

## 计算机系统与操作系统
计算机系统由一个自动化操作系统全面管理

## 计算机操作系统
是建构在计算机硬件系统上的最基础系统软件

- 操作接口: 系统程序, 为用户提供解决操作计算机和计算共性问题的所有服务的集合
- 程序接口: 系统调用, 为所有运行程序提供访问OS的接口

### 系统调用的实现机制
陷入处理机制: 计算机中控制和实现系统调用的机制
陷入指令: 也称为访管指令

### 系统调用的实现要点
1. 编写系统调用处理程序
2. 设计系统调用入口地址表, 表的每个入口地址指向一个系统调用处理程序
3. 保护发生系统调用时的处理器现场

实现流程

1. CPU执行用户程序, 执行到 系统调用i 这一条陷入指令
2. 激活内核, 内核进行现场保护
3. 取用户程序系统调用时存入指定寄存器的系统调用号i
4. 根据i在入口地址表中获得对应系统调用处理程序的入口地址
5. 执行该系统调用处理程序
6. 将返回值存入指定寄存器
7. 恢复现场
8. 继续执行用户程序

在这个过程中发生了两个空间与模式的切换即 用户空间与内核空间, 用户态与内核态

## 操作系统的诞生
OS诞生前是手工操作阶段和早期批处理系统
- 手工操作: 拨动开关
- 早期批处理系统: 引入作业控制语言, 用户编写作业说明书

1. 多道程序设计: 让多个程序同时进入计算机的内存进行计算
2. 多道程序系统: 必须提供多道程序之间的调度, 切换和保护
3. 磁盘: 只有程序的部分进入内存, 其他先存入磁盘


### 操作系统诞生带来的新概念
1. 内核(kernel): 控制多道程序执行的系统超级程序
2. 进程(process): 内核控制的多道程序的实体(**一个独立执行的程序指令流**)
3. 线程(thread): 进程内部的一条独立执行路径，共享进程的资源
4. 中断驱动的操作系统内核程序: 中断是激活操作系统内核的唯一手段
5. 文件: 块设备(磁盘)上的信息被抽象为用户逻辑上独立完整的信息体
6. 内存的分割: 为支持多道程序运行, 必然要对内存进行分割, 防止内存中不同程序间相互影响
7. 虚存: 使用磁盘的空间扩展内存空间, 来支持更多的程序进入内存, 并不是实际的内存空间, 被称为虚存

## 计算机系统的资源
包括硬件资源和信息资源
1. 硬件资源: 处理器, 内存, 外设
2. 信息资源: 程序, 数据

资源的管理技术
1. 资源复用
   1. 时分复用 *处理器*
   2. 空分复用 *内存*
2. 资源虚化 *虚存*
3. 资源抽象 *驱动程序*

## 操作系统的人机交互HCI
OS改善人机界面, 为用户提供更方便的使用计算机环境
HCI一直是操作系统研发的重点

## 操作系统软件的规模
OS作为大型的软件, 结构设计是关键
- OS构件: 内核, 进程, 线程, 管程
- 内核设计是最复杂的
- 设计概念: 模块化, 层次式, 虚拟化

## 操作系统的内核
可以分为
1. 单内核: 内核中各个部件杂然混居
2. 微内核: 强调结构性部件和功能性部件的分离
3. 混合内核: 单内核和微内核的混合
4. 外内核: 尽可能减少内核的软件抽象化和传统微内核的消息传递机制，使得开发者专注于硬件的抽象化; 部分嵌入式系统使用

单内核的执行效率较高, 微内核的软件开发质量较高, 运行可靠性较高

## 多道程序系统的特点
- CPU与外部设备充分并行
- 外部设备之间充分并行
- 发挥CPU的使用效率
- 提高单位时间的计算量
- 但是对于一个程序,他自身的计算时间增加

## 多道程序系统的实现
- 为进入内存执行的程序建立管理实体, 也就是进程
- OS管理与控制进程的执行
- OS协调管理各类资源在进程间的使用

一系列问题
1. 如何使用资源
2. 如何复用CPU
3. 如何使CPU与IO设备充分并行
4. 如何让正在运行的程序让出CPU